# go-kit-examples
æœ¬ä»“åº“è‡´åŠ›äºä¸ºæƒ³è¦ä½¿ç”¨Go-kitæ„å»ºå¾®æœåŠ¡æ¶æ„çš„ä¸­æ–‡å¼€å‘è€…æä¾›å¸®åŠ©ã€‚

ä»“åº“åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š
-   Go-kitæ¡†æ¶ä¸­æ–‡ä»‹ç»ï¼ˆREADME.mdï¼‰
-   å¸¦ä¸­æ–‡æ³¨é‡Šçš„go-kitå®˜æ–¹ç¤ºä¾‹ï¼ŒåŒ…å«å¾ªåºæ¸è¿›çš„å¤šä¸ª[ç¤ºä¾‹é¡¹ç›®](https://github.com/chaseSpace/go-kit-examples/tree/master/official_examples)  
    (ä¸è¿‡å®˜æ–¹çš„4,5ç¤ºä¾‹ä»…ä½œåŠŸèƒ½æ¼”ç¤ºï¼Œä»£ç ä¸å¤Ÿç®€æ˜ï¼Œæ–°æ‰‹çœ‹èµ·æ¥ä¼šæœ‰äº›æ™¦æ¶©ï¼Œå»ºè®®å…³æ³¨ä¸‹é¢çš„æ¼”ç¤ºé¡¹ç›®)
-   [å®Œå–„ä¼˜åŒ–åçš„new_addsvc(å¼ºçƒˆæ¨è)](#å®Œæ•´å¯ç”¨äºå®æˆ˜å‚è€ƒçš„é¡¹ç›®)
-   [ä¸šç•Œå¸¸ç”¨çš„Goé¡¹ç›®ç›®å½•ç»“æ„(æ¨èäº†è§£)](#ä¸šç•Œå¸¸ç”¨çš„Goé¡¹ç›®ç›®å½•ç»“æ„)

æ¼”ç¤ºé¡¹ç›®ï¼š  
> 1. æ¼”ç¤ºé¡¹ç›®ä½¿ç”¨kitè¾…åŠ©å¼€å‘go-kité¡¹ç›®ï¼Œä»¥æé«˜å¼€å‘æ•ˆç‡ï¼é¡¹ç›®ä»£ç ååˆ†ç®€æ˜ï¼Œå¹¶åŒ…å«å……åˆ†æ³¨é‡Šï¼Œå¼ºçƒˆæ¨è~  
> 2. helloå’Œgatewayé¡¹ç›®ç›®å‰æ¶‰åŠåˆ°çš„æŠ€æœ¯å…³é”®è¯: 
`router`, `grpc`, `trace`, `metrics`, `ratelimit`, `breaker`, 
`jwt`, `redis`, `timer task`, `distrib lock`
-   [ä½¿ç”¨kitä»£ç ç”Ÿæˆå·¥å…·å¿«é€Ÿå¼€å‘go-kitå¾®æœåŠ¡-hellosvc](#ä½¿ç”¨ä»£ç ç”Ÿæˆå·¥å…·å¿«é€Ÿå¼€å‘go-kitå¾®æœåŠ¡) ğŸ¦
-   [go-kit APIç½‘å…³](#APIç½‘å…³) ğŸ¤
___
-   [æ›´æ–°æ—¥å¿—](#æ›´æ–°æ—¥å¿—)
-   [Go-kitä¸­æ–‡ç¾¤ç»„(æ¨é€ä»“åº“æ›´æ–°)](#go-kitä¸­æ–‡ç¾¤ç»„)

<br/>

## æ‹‰å–ä»“åº“åˆ°æœ¬åœ°
æŒç»­è·Ÿè¸ªæœ¬é¡¹ç›®ï¼Œè¯·å…ˆcloneæ­¤åˆ°æœ¬åœ°ï¼ˆä¸è¦ä½¿ç”¨gogetå‘½ä»¤ï¼Œå› ä¸ºè¿™ä¸æ˜¯ä¸€ä¸ªgo pkgï¼‰
```bash
git clone https://github.com/chaseSpace/go-kit-examples.git
```
åç»­æ›´æ–°è¯·ä½¿ç”¨`git pull origin master`å‘½ä»¤

## Go-kitå®˜æ–¹ä»‹ç»
[![](https://img.shields.io/static/v1?label=Github&message=go-kit&color=important)](https://github.com/go-kit/kit)
![](https://badgen.net/github/stars/go-kit/kit)
![](https://badgen.net/github/release/go-kit/kit)

Go-kitæ˜¯ä½¿ç”¨Goè¯­è¨€æ„å»ºå¾®æœåŠ¡çš„ä¸€ä¸ªå·¥å…·ç®±ï¼Œå®ƒå¯ä»¥è§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„ä¸­çš„å¸¸è§é—®é¢˜ï¼›
èƒ½å¤Ÿè®©æˆ‘ä»¬ä¸“æ³¨äºä¸šåŠ¡ä»£ç ã€‚

## ç‰¹ç‚¹

å·¥å…·é›†ï¼Œé€šè¿‡ä¸åŒpkgæ”¯æŒauth/metrics/log/service-discovery/tracing/transport, 
å¹¶ä¸”å¯ä»¥è‡ªå·±å†³å®šå“ªä¸ªåŠŸèƒ½/åè®®ä½¿ç”¨å“ªä¸ªåº“/åç«¯ï¼Œæ¯”å¦‚æœåŠ¡å‘ç°å¯ä»¥ä½¿ç”¨consulæˆ–è€…etcdï¼Œéƒ½æœ‰é›†æˆå¥½çš„æ¨¡å—ç›´æ¥ä½¿ç”¨ã€‚

## æ¡†æ¶åˆ†å±‚

 1. Transport layer (HTTP, gRPC, Thrift, and net/rpc, è‡ªç”±å®šåˆ¶)
 2. Endpoint layer
 3. Service layer (èšç„¦ä¸šåŠ¡é€»è¾‘)

è¯·æ±‚ç”±ç¬¬ä¸€å±‚æŒ‰åºæµå‘ç¬¬ä¸‰å±‚ã€‚ 

### Endpoints

   ç›¸å½“äºcontrollerå†…çš„ä¸€ä¸ªhandlerï¼Œå¦‚æœåŒæ—¶å®ç°HTTPå’ŒgRPCåè®®ï¼Œå¯ä»¥æ–¹ä¾¿çš„å°†ä¸¤ç§è¯·æ±‚å‘å¾€åŒä¸€ä¸ªendpointã€‚

### Services

  - è¿™ä¸€å±‚ä¸»è¦èšç„¦ä¸šåŠ¡é€»è¾‘ï¼Œä¸€ä¸ªserviceå¯ä»¥è¢«å¤šä¸ªendpointè°ƒç”¨ï¼Œä¸€ä¸ªendpointå¯ä»¥è°ƒç”¨å¤šä¸ªserviceæ–¹æ³•
  - ä¸gRPCä¸€æ ·ï¼Œä¸€ä¸ªserviceåœ¨ä»£ç æ˜¯ä½œä¸ºä¸€ä¸ªinterfaceï¼Œéœ€è¦æˆ‘ä»¬å®ç°è¿™ä¸ªinterface
  - serviceå±‚åªå…³æ³¨ä¸šåŠ¡ï¼Œä¸endpoint/transportæ— å…³ï¼Œä»£ç å±‚åˆ†ç¦»
  
## Middlewares
 
 Go kitä½¿ç”¨ä¸­é—´ä»¶æ¥æ·»åŠ æ›´å¤šåŠŸèƒ½ï¼ŒåŒ…æ‹¬æ—¥å¿—ã€é™é€Ÿã€è´Ÿè½½å‡è¡¡ã€é“¾è·¯è¿½è¸ªç­‰ç­‰ã€‚
 
## æ¡†æ¶è®¾è®¡
å…¸å‹çš„æ´‹è‘±æ¨¡å‹

![Design](https://gokit.io/faq/onion.png)

è¿™äº›å±‚å®Œå…¨å¯ä»¥åˆ’åˆ†ä¸ºä¸‰ä¸ªåŸŸï¼š

-   æœ€é å†…çš„--ServiceåŸŸ

    `æœåŠ¡å®šä¹‰ä»¥åŠå…·ä½“ä¸šåŠ¡é€»è¾‘çš„åœ°æ–¹`
-   ä¸­é—´çš„--EndpointåŸŸ

    `æ¥å£çš„æŠ½è±¡ï¼Œç§°ä¸ºç«¯ç‚¹ï¼Œä¸€ä¸ªç«¯ç‚¹å¯¹å¤–æ˜ å°„ä¸ºä¸€ä¸ªæ¥å£ï¼Œä¸€ä¸ªç«¯ç‚¹å†…å¯ä»¥è°ƒç”¨ServiceåŸŸå®šä¹‰çš„ä¸€ä¸ªæˆ–å¤šä¸ªæ–¹æ³•ï¼›
    åœ¨è¿™é‡Œä¼šå®æ–½ä¿è¯æ¥å£å®‰å…¨å’Œé˜²è„†å¼±çš„æªæ–½
    `
-  æœ€å¤–å±‚çš„TransportåŸŸ

    `endpointç»‘å®šå…·ä½“ä¼ è¾“åè®®çš„åœ°æ–¹`
    
## Errorå¤„ç†

serviceå¯èƒ½ä¼šè¿”å›errï¼Œæœ‰ä¸¤ç§æ–¹å¼åœ¨endpointä¸­æ¥å°è£…errï¼š

-  ç¬¬ä¸€ç§ï¼Œåœ¨service response structä¸­åŒ…å«ä¸šåŠ¡err
-  ç¬¬äºŒç§ï¼Œåœ¨å°†service errä¼ é€’åˆ°endpointçš„err

æ³¨æ„ä¸€ç‚¹ï¼šendpointè¿”å›çš„errä¼šè¢«ä¸­é—´ä»¶æ•è·åˆ°ï¼Œæ¯”å¦‚æ–­è·¯å™¨ï¼›æ‰€ä»¥è¿™é‡ŒåŒºåˆ†ç½‘ç»œå¯¼è‡´çš„errå’Œserviceè¿”å›çš„ä¸šåŠ¡errã€‚


## æœåŠ¡å‘ç°

go-kitæœ‰ç›¸åº”çš„pkgæ”¯æŒConsul, etcd, ZooKeeper, and DNS SRV

## ç›‘æ§

go-kitæœ‰ç»„ä»¶æ”¯æŒç°ä»£åŒ–çš„ç›‘æ§ç³»ç»ŸPrometheus, åŒæ—¶å®˜æ–¹ä¹Ÿæ¨èä½¿ç”¨å®ƒæ¥å»ºç«‹go-kitæœåŠ¡

## ä¸šç•Œå¸¸ç”¨çš„Goé¡¹ç›®ç›®å½•ç»“æ„

è§„èŒƒçš„Goé¡¹ç›®ç›®å½•ç»“æ„ï¼Œå‚è€ƒ[golang-standards/project-layout](https://github.com/golang-standards/project-layout/blob/master/README_zh.md)

åœ¨æ­¤åŸºç¡€ä¸Šæˆ‘æ·»åŠ äº†protoæ–‡ä»¶çš„ç›®å½•åˆ’åˆ†ï¼Œè¯·å‚è€ƒ`go_project_template`ç›®å½•ï¼Œ
å…³äºç›¸å…³ç›®å½•çš„ä½œç”¨è¯´æ˜è¯¦è§å„å­ç›®å½•ä¸­çš„readme.mdæˆ–ä»£ç ï¼›åœ¨`/script`ç›®å½•å­˜æ”¾äº†ä¸€ä¸ª`main.sh`ï¼Œå¯ä¾›å‚è€ƒï¼Œä¹Ÿå¯ç›´æ¥ä½¿ç”¨

> æŒ‰ç…§Goé¡¹ç›®è§„èŒƒç»„ç»‡ä»£ç ç»“æ„ï¼Œå¯ä»¥æå¤§åœ°å‡å°‘æ²Ÿé€šæˆæœ¬ï¼Œæé«˜å›¢é˜Ÿå¼€å‘æ•ˆç‡

## å®Œæ•´å¯ç”¨äºå®æˆ˜å‚è€ƒçš„é¡¹ç›®

[new_addsvc](https://github.com/chaseSpace/go-kit-examples/tree/master/demo_project/new_addsvc)

- `/pkg`ç›®å½•åŒ…å«äº†serviceã€endpointã€transportä¸‰å±‚çš„ä»£ç ï¼Œå‰ä¸¤è€…éƒ½æœ‰ä¸­é—´ä»¶ï¼Œä¹Ÿå¯ä»¥åœ¨transportå±‚æ·»åŠ ä¸­é—´ä»¶ä»¥å®ç°å®Œæ•´çš„é“¾è·¯è¿½è¸ª
- `/pb`ç›®å½•åŒ…å«äº†å­˜æ”¾protoæ–‡ä»¶çš„`proto/`ç›®å½•å’Œå­˜æ”¾`*.pb.go`æ–‡ä»¶çš„`gen-go/`ç›®å½•
- `/internal`ç›®å½•åŒ…å«äº†è¿™ä¸ªappç§æœ‰çš„æ–¹æ³•

è¿™ä¸ªé¡¹ç›®ä¼šæŒç»­æ›´æ–°ï¼ŒåŒ…æ‹¬é¡¹ç›®ç›®å½•ç»“æ„ï¼Œä»£ç ä¼˜åŒ–ï¼Œä¸è¿‡åŸºæœ¬éª¨æ¶å·²æ­æˆï¼Œåç»­è¦åšçš„æ˜¯æå–å¯ä»¥æå–çš„ä»£ç åˆ°foundationä¸­ï¼Œä»¥åŠå¿…è¦çš„ç»“æ„è°ƒæ•´ï¼Œ
è¾ƒå¤§æ›´æ–°ä¼šä»¥æ—¥å¿—å½¢å¼è´´å‡ºã€‚

å»ºè®®å…ˆæ‹‰å–åˆ°æœ¬åœ°ç ”ç©¶/å­¦ä¹ ï¼Œè·Ÿéšä½œè€…æŒç»­ä¼˜åŒ–~

æ¬¢è¿æå‡ºä¼˜åŒ–æ„è§ï¼ 

## ä½¿ç”¨ä»£ç ç”Ÿæˆå·¥å…·å¿«é€Ÿå¼€å‘go-kitå¾®æœåŠ¡

[GettingStart](https://github.com/chaseSpace/go-kit-examples/blob/master/GettingStart.md)

## APIç½‘å…³

- ä½¿ç”¨å…·æœ‰å¼ºå¤§è·¯ç”±å’Œå‚æ•°åŒ¹é…åŠŸèƒ½çš„[mux](https://github.com/gorilla/mux) åº“ä½œä¸ºè·¯ç”±å™¨ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ä½ å–œæ¬¢çš„åº“æ›¿æ¢ï¼‰
- åŒ…å«äº†grpcæ¥å£è°ƒç”¨ï¼Œå¹¶ç®€å•æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨muxçš„å‚æ•°åŒ¹é…åŠŸèƒ½
- æä¸ºç®€æ´å®ç”¨çš„ä»£ç 

[Gateway](https://github.com/chaseSpace/go-kit-examples/tree/master/demo_project/gateway) 

## æ›´æ–°æ—¥å¿—

[CHANGELOG][CHANGELOG] (ä¸Šæ¬¡æ›´æ–°äº2020å¹´10æœˆ25æ—¥)

[CHANGELOG]:https://github.com/chaseSpace/go-kit-examples/blob/master/CHANGELOG.md

## TODO

-   å¢åŠ å®šæ—¶ä»»åŠ¡çš„å®æˆ˜ç¤ºä¾‹ï¼ˆnew_addsvcï¼‰
-   gatewayå¢åŠ service discovery(consul)
-   åŸºäºjaegerçš„traceä½¿ç”¨ï¼ˆæ–‡æ¡£ï¼‰

## Go-kitä¸­æ–‡ç¾¤ç»„

![](https://github.com/chaseSpace/go-kit-examples/blob/master/wxgroup.jpg)